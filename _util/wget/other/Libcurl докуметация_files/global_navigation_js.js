
(function(){var menuAimModule,sharedProperties,utils;sharedProperties={mouseLocs:[],mousemoveTracked:false};utils={filter:function(elements,filterSelector){var elementsCnt,elementNo,nodeList,nodeListCnt,nodeNo,result;result=[];elementsCnt=elements.length;for(elementNo=0;elementNo<elementsCnt;++elementNo){if(!elements[elementNo]||!elements[elementNo].parentNode){continue;}
nodeList=elements[elementNo].parentNode.querySelectorAll(filterSelector);nodeListCnt=nodeList.length;for(nodeNo=0;nodeNo<nodeListCnt;++nodeNo){if(nodeList[nodeNo]!==elements[elementNo]){continue;}
result.push(elements[elementNo]);}}
return result;},extend:function(dst,src){var p;for(p in src){if(src.hasOwnProperty(p)){dst[p]=src[p];}}
return dst;},slope:function(a,b){return(b.y-a.y)/(b.x-a.x);}};menuAimModule=function(){var DELAY,MOUSE_LOCS_TRACKED,activeRow,lastDelayLoc,mouseLocs,menu,options,timeoutId,activate,activationDelay,clickRow,mouseenterRow,mouseenterMenu,mouseleaveMenu,mouseleaveRow,mousemoveDocument,possiblyActivate,mouseMoveTrackerOff,mouseMoveTrackerOn,rows;lastDelayLoc=null;timeoutId=null;mouseLocs=sharedProperties.mouseLocs;options={activeRow:null,rowSelector:"> li",submenuSelector:"*",submenuDirection:"right",tolerance:75,enter:Function.prototype,exit:Function.prototype,activate:Function.prototype,deactivate:Function.prototype,exitMenu:Function.prototype};MOUSE_LOCS_TRACKED=3;DELAY=300;this.init=function(menuToHandle,opts){var i,j,rowSelector;menu=menuToHandle;options=utils.extend(options,opts);activeRow=options.activeRow;menu.addEventListener("mouseleave",mouseleaveMenu);menu.addEventListener("mouseenter",mouseenterMenu);rowSelector=(menu.id?"#"+menu.id:menu.nodeName)+" "+options.rowSelector
rows=menu.querySelectorAll(rowSelector);for(i=0,j=rows.length;i<j;++i){rows[i].addEventListener("mouseenter",mouseenterRow);rows[i].addEventListener("mouseleave",mouseleaveRow);rows[i].addEventListener("click",clickRow);}
return this;};this.reset=function(){var i,j;if(menu){menu.removeEventListener("mouseleave",mouseleaveMenu);menu.removeEventListener("mouseenter",mouseenterMenu);for(i=0,j=rows.length;i<j;++i){rows[i].removeEventListener("mouseenter",mouseenterRow);rows[i].removeEventListener("mouseleave",mouseleaveRow);rows[i].removeEventListener("click",clickRow);}}
return this;};this.resetActiveRow=function(){activeRow=options.activeRow;};mouseMoveTrackerOn=function(){if(!sharedProperties.mousemoveTracked&&!window.touchstart){document.addEventListener("mousemove",mousemoveDocument);sharedProperties.mousemoveTracked=true;}};mouseMoveTrackerOff=function(){if(sharedProperties.mousemoveTracked){document.removeEventListener("mousemove",mousemoveDocument);sharedProperties.mousemoveTracked=false;}};mousemoveDocument=function(e){mouseLocs.push({x:e.pageX,y:e.pageY});if(mouseLocs.length>MOUSE_LOCS_TRACKED){mouseLocs.shift();}};mouseleaveMenu=function(){if(timeoutId){clearTimeout(timeoutId);}
if(activeRow&&options.exitMenu(this)){options.deactivate(activeRow);activeRow=null;}
mouseMoveTrackerOff();};mouseenterMenu=function(){mouseMoveTrackerOn();};mouseenterRow=function(){if(timeoutId){clearTimeout(timeoutId);}
options.enter(this);possiblyActivate(this);};mouseleaveRow=function(){options.exit(this);};clickRow=function(event){activate(this,event);};activate=function(row,event){if(row==activeRow){return;}
if(activeRow){options.deactivate(activeRow,event);}
options.activate(row,event);activeRow=row;};possiblyActivate=function(row){var delay=activationDelay();if(delay){timeoutId=setTimeout(function(){possiblyActivate(row);},delay);}else{activate(row);}};activationDelay=function(){var offset,upperLeft,upperRight,lowerLeft,lowerRight,loc,prevLoc,decreasingCorner,increasingCorner,decreasingSlope,increasingSlope,prevDecreasingSlope,prevIncreasingSlope;if(!activeRow||(options.submenuSelector!=="*"&&utils.filter([activeRow],options.submenuSelector).length===0)){return 0;}
offset=menu.getBoundingClientRect();upperLeft={x:offset.left,y:offset.top+window.pageYOffset-options.tolerance};upperRight={x:offset.left+menu.offsetWidth,y:upperLeft.y};lowerLeft={x:offset.left,y:offset.top+window.pageYOffset+menu.offsetHeight+options.tolerance};lowerRight={x:offset.left+menu.offsetWidth,y:lowerLeft.y};loc=mouseLocs[mouseLocs.length-1];prevLoc=mouseLocs[0];if(!loc){return 0;}
if(!prevLoc){prevLoc=loc;}
if(prevLoc.x<offset.left||prevLoc.x>lowerRight.x||prevLoc.y<offset.top||prevLoc.y>lowerRight.y){return 0;}
if(lastDelayLoc&&loc.x==lastDelayLoc.x&&loc.y==lastDelayLoc.y){return 0;}
decreasingCorner=upperRight,increasingCorner=lowerRight;if(options.submenuDirection=="left"){decreasingCorner=lowerLeft;increasingCorner=upperLeft;}else if(options.submenuDirection=="below"){decreasingCorner=lowerRight;increasingCorner=lowerLeft;}else if(options.submenuDirection=="above"){decreasingCorner=upperLeft;increasingCorner=upperRight;}
decreasingSlope=utils.slope(loc,decreasingCorner);increasingSlope=utils.slope(loc,increasingCorner);prevDecreasingSlope=utils.slope(prevLoc,decreasingCorner);prevIncreasingSlope=utils.slope(prevLoc,increasingCorner);if(decreasingSlope<prevDecreasingSlope&&increasingSlope>prevIncreasingSlope){lastDelayLoc=loc;return DELAY;}
lastDelayLoc=null;return 0;};};window.menuAim=function(menuToHandle,opts){var menuAim;menuAim=new menuAimModule();return menuAim.init(menuToHandle,opts);};})();;(function(){'use strict';var utils,DelayedHoverModule;utils={extend:function(dst,src){var p;for(p in src){if(src.hasOwnProperty(p)){dst[p]=src[p];}}
return dst;}};DelayedHoverModule=function(){var getSquaredMoveDistance,eventHandler,mouseEnterHandler,mouseLeaveHandler,mouseMoveHandler,lastLocation,lastCheckedLocation,options,possiblyActivate,timeoutId;options={checkInterval:100,maxActivationDistance:20,onActivate:Function.prototype,onDeactivate:Function.prototype,activateOnClick:true};getSquaredMoveDistance=function(){return(lastCheckedLocation.x-lastLocation.x)*(lastCheckedLocation.x-lastLocation.x)+
(lastCheckedLocation.y-lastLocation.y)*(lastCheckedLocation.y-lastLocation.y);};possiblyActivate=function(){var context=this;if(lastLocation&&getSquaredMoveDistance()<=options.maxSquaredActivationDistance){options.onActivate.apply(context,arguments);}else{if(timeoutId){clearTimeout(timeoutId);}
timeoutId=setTimeout(function(){possiblyActivate.apply(context,arguments);},options.checkInterval);}
if(lastLocation){lastCheckedLocation=lastLocation;}};eventHandler=function(target,event,handler){var i,targetsCount;targetsCount=target.length;if(targetsCount>1){for(i=0;i<targetsCount;i++){target[i].addEventListener(event,handler);}}else{target.addEventListener(event,handler);}};mouseMoveHandler=function(e){lastLocation={x:e.pageX,y:e.pageY};};mouseEnterHandler=function(e){lastCheckedLocation={x:e.pageX,y:e.pageY};lastLocation=null;possiblyActivate.apply(this,arguments);};mouseLeaveHandler=function(){if(timeoutId){clearTimeout(timeoutId);}
options.onDeactivate.apply(this,arguments);};this.init=function(elem,opts){options=utils.extend(options,opts);options.maxSquaredActivationDistance=options.maxActivationDistance*options.maxActivationDistance;if(options.activateOnClick){eventHandler(elem,'click',options.onActivate);}
eventHandler(elem,'mouseenter',mouseEnterHandler);eventHandler(elem,'mouseleave',mouseLeaveHandler);eventHandler(elem,'mousemove',mouseMoveHandler);return this;};};window.delayedHover=function(elem,options){var delayedHover=new DelayedHoverModule();return delayedHover.init(elem,options);};})();;define('wikia.scrollToLink',['wikia.window','wikia.querystring','wikia.history','jquery'],function(win,qs,hist,$){'use strict';function getOffsetTop(element){var offsetTop=$(element).offset().top;return offsetTop|0;}
function disableBrowserJump(){if(win.location.hash){win.scrollTo(0,0);win.setTimeout(function(){win.scrollTo(0,0);},1);}}
function scrollToElement(element,offsetToScroll){var targetOffset=getOffsetTop(element);win.setTimeout(function(){win.scrollTo(win.pageXOffset,targetOffset+offsetToScroll);},1);}
function handleScrollTo(href,offsetToScroll){offsetToScroll=offsetToScroll||0;var sanitizedHref=qs().sanitizeHref(href),doc=win.document,target;if(!!sanitizedHref){target=doc.getElementById(sanitizedHref);if(!!target){scrollToElement(target,offsetToScroll);return hist.pushState({},doc.title,win.location.pathname+'#'+sanitizedHref);}}
return false;}
return{handleScrollTo:handleScrollTo,scrollToElement:scrollToElement,disableBrowserJump:disableBrowserJump};});;(function($){'use strict';var TransparentOut=function(){var $domNode,initialize=function(){$domNode=$('<div class="transparent-out" />');$('body').append($domNode);};this.show=function(){if(!$domNode){initialize();}
$domNode.addClass('visible');};this.hide=function(){if($domNode){$domNode.removeClass('visible');}};this.bindClick=function(callback){if(!$domNode){initialize();}
$domNode.on('click touchstart',$.proxy(function(e){e.preventDefault();e.stopPropagation();callback(this);},this));};};window.transparentOut=new TransparentOut();})(jQuery);;define('venus.layout',['wikia.window'],function(win){'use strict';return{normalTextFontSize:12,breakpoints:{smallMin:768,mediumMin:1024,bigMin:1496},grid:{small:{columnPadding:8,gutter:8,innerColumn:38},medium:{columnPadding:10,gutter:10,innerColumn:53},big:{columnPadding:12,gutter:12,innerColumn:58}},getBreakpoint:function(){var breakpoint='small',currentWidth=win.innerWidth;if(currentWidth>this.breakpoints.mediumMin){breakpoint='medium';}
if(currentWidth>this.breakpoints.bigMin){breakpoint='big';}
return breakpoint;},getGridColumnWidth:function(breakpoint,columnCount){var currentBreakpointGrid=this.grid[breakpoint];return columnCount*(currentBreakpointGrid.innerColumn+2*currentBreakpointGrid.columnPadding+currentBreakpointGrid.gutter)-currentBreakpointGrid.gutter;}};});;define('GlobalNavigationiOSScrollFix',['jquery','wikia.window'],function($,win){'use strict';var cachedScrollY;function scrollToTop($element){cachedScrollY=win.scrollY;$element.addClass('static');setTimeout(function(){win.scrollTo(win.scrollX,0);},0);}
function restoreScrollY($element){$element.removeClass('static');if(cachedScrollY){win.scrollTo(win.scrollX,cachedScrollY);}}
return{scrollToTop:scrollToTop,restoreScrollY:restoreScrollY};});;require(['wikia.scrollToLink','wikia.window','venus.layout','jquery','wikia.browserDetect'],function(scrollToLink,win,layout,$,browserDetect){'use strict';var offset=0;function hashChangeHandler(event){if(scrollToLink.handleScrollTo(win.location.hash,offset)||browserDetect.isIOS7orLower()){event.preventDefault();return false;}}
function initScrollToLink(){offset=-(win.document.getElementById('globalNavigation').offsetHeight+
layout.normalTextFontSize);scrollToLink.disableBrowserJump();win.setTimeout(function(){scrollToLink.handleScrollTo(win.location.hash,offset);},1000);$(win).on('hashchange',hashChangeHandler);}
win.GlobalNavigationScrollToElement=function(element){scrollToLink.scrollToElement(element,offset)};$(initScrollToLink);});;$(function($){'use strict';var searchSuggestionsShowed,track,$globalNavigation,$globalNavigationSearch;$globalNavigation=$('#globalNavigation');$globalNavigationSearch=$globalNavigation.find('#searchForm');searchSuggestionsShowed=false;function globalNavigationClickTrackingHandler(event){var $element,label,$parent;if(event.type==='mousedown'&&event.which!==1){return;}
track=Wikia.Tracker.buildTrackingFunction({action:Wikia.Tracker.ACTIONS.CLICK,category:'top-nav',trackingMethod:'ga'});$element=$(event.target);if($element.closest('.wikia-logo').length>0){label='wikia-logo';}else if($element.closest('.hub-links').length>0||$element.closest('.hub-list').length>0){label='hub-item';}else if($element.data('id')==='logout'){label='user-menu-logout';}else if($element.data('id')==='help'){label='user-menu-help';}else if($element.data('id')==='preferences'){label='user-menu-preferences';}else if($element.data('id')==='mytalk'){if($element.hasClass('message-wall')){label='user-menu-message-wall';}else{label='user-menu-talk';}}else if($element.closest('.ajaxRegisterContainer').length>0){label='register';}else if($element.closest('.notifications-for-wiki').length>0){$parent=$element.closest('.notifications-for-wiki');if($parent.data('wiki-id')===parseInt(window.wgCityId)){label='notification-item-local';}else{label='notification-item-cross-wiki';}}else if($element.closest('.start-wikia').length>0){label='start-a-wiki';}else if($element.hasClass('login-button')){label='login';}else if($element.closest('.ajaxLogin').attr('accesskey')==='.'){label='user-menu-profile';}else{return;}
track({label:label});}
function searchSuggestionsClickTrackingHandler(event){if(event.type==='mousedown'&&event.which!==1){return;}
trackSearch({browserEvent:event,label:'search-suggest'});}
function searchSubmitButtonClickTrackingHandler(event){if(event.which===1&&event.clientX>0){trackSearch({label:!searchSuggestionsShowed?'search-button':'search-after-suggest-button'});}}
function searchSubmitEnterPressTrackingHandler(event){if(event.which===13&&$(this).is(':focus')){trackSearch({label:!searchSuggestionsShowed?'search-enter':'search-after-suggest-enter'});}}
function searchSuggestionsEnterPressOnSuggestionsTrackingHandler(){trackSearch({label:'search-suggest-enter'});}
function searchSuggestionsShowedTrackingHandler(){searchSuggestionsShowed=true;trackSearch({action:Wikia.Tracker.ACTIONS.VIEW,label:'search-suggest-show'});}
function trackSearch(data){track=Wikia.Tracker.buildTrackingFunction({category:'search',trackingMethod:'both'});data.action=data.action||Wikia.Tracker.ACTIONS.CLICK;track(data);}
$globalNavigation.on('mousedown touchstart',globalNavigationClickTrackingHandler);$globalNavigationSearch.on('mousedown touchstart','.autocomplete',searchSuggestionsClickTrackingHandler).on('mousedown touchstart','.search-submit',searchSubmitButtonClickTrackingHandler).on('keypress','[name=search]',searchSubmitEnterPressTrackingHandler).on('suggestEnter',searchSuggestionsEnterPressOnSuggestionsTrackingHandler).one('suggestShow',searchSuggestionsShowedTrackingHandler);});;define('wikia.globalnavigation.lazyload',['jquery','wikia.nirvana','wikia.querystring'],function lazyLoad($,nirvana,Querystring){'use strict';var menuLoading=false,menuLoaded=false;function getMenuItemsDone(menuItems){var $sections=$($.parseHTML(menuItems)).removeClass('active'),$hubs=$('#hubs'),$verticals=$('> .hub-list',$hubs),$hubLinks=$('> .hub-links',$hubs),subMenuSelector='.'+$('.active',$verticals).data('vertical')+'-links';$('> .active',$hubLinks).removeClass('active');$hubLinks.append($sections);$hubLinks.find(subMenuSelector).addClass('active');menuLoading=false;menuLoaded=true;}
function errorHandler(){menuLoading=false;menuLoaded=false;}
function isMenuWorking(){return(menuLoading||menuLoaded);}
function getHubLinks(){var lang,data={};if(isMenuWorking()){return;}
menuLoading=true;lang=new Querystring().getVal('uselang');if(lang){data.uselang=lang;}
nirvana.sendRequest({controller:'GlobalNavigationController',method:'lazyLoadHubsMenu',format:'html',type:'GET',data:data}).then(getMenuItemsDone,errorHandler);}
return{getHubLinks:getHubLinks,isMenuWorking:isMenuWorking};});;require(['jquery','wikia.window','wikia.globalnavigation.lazyload'],function($,w,GlobalNavLazyLoad){'use strict';var $entryPoint,$hubLinks,$hubs,$verticals;function activateSubmenu(row){var $row=$(row),verticalClass='.'+$row.data('vertical')+'-links';if(w.Wikia.isTouchScreen()){if(!$row.hasClass('active')){event.preventDefault();}}
$(verticalClass,$hubLinks).add($row).addClass('active');}
function deactivateSubmenu(row){$('> .hub-menu-section',$hubLinks).add(row).removeClass('active');}
function openMenu(){$entryPoint.addClass('active');w.transparentOut.show();if(!GlobalNavLazyLoad.isMenuWorking()){GlobalNavLazyLoad.getHubLinks();}
$('#globalNavigation').trigger('hubs-menu-opened');}
function closeMenu(){$entryPoint.removeClass('active');w.transparentOut.hide();}
$(function(){$hubs=$('#hubs');$hubLinks=$hubs.find('> .hub-links');$verticals=$hubs.find('> .hub-list');$entryPoint=$('#hubsEntryPoint');w.transparentOut&&w.transparentOut.bindClick(closeMenu);if(navigator.userAgent.toLowerCase().indexOf('android')>-1){$verticals.addClass('backface-off');}
$entryPoint.on('click','.hubs-entry-point',function(ev){ev.preventDefault();ev.stopPropagation();if($entryPoint.hasClass('active')){closeMenu();}else{openMenu();}});w.menuAim($verticals.get(0),{activeRow:$verticals.find('.active').get(0),rowSelector:'.hub-link',tolerance:85,activate:activateSubmenu,deactivate:deactivateSubmenu});w.transparentOut.bindClick(closeMenu);if(!w.ontouchstart){w.delayedHover($entryPoint.get(0),{checkInterval:100,maxActivationDistance:20,onActivate:openMenu,onDeactivate:closeMenu,activateOnClick:false});}else{$entryPoint.click(openMenu);}});});;require(['jquery','wikia.browserDetect','GlobalNavigationiOSScrollFix'],function($,browserDetect,scrollFix){'use strict';var $selectElement,$chevron,$searchInput,$globalNav,$inputResultLang,$formElement,$searchLabel,isLocalSearchDisabled,$autocompleteObj;function setElements(){$inputResultLang=$('#searchInputResultLang');$formElement=$('#searchForm');$searchLabel=$('#searchLabelInline');isLocalSearchDisabled=$('#searchLabelSingle').length>0;$selectElement=$('#searchSelect');$chevron=$('#searchFormChevron');$searchInput=$('#searchInput');$globalNav=$('#globalNavigation');}
function setFormOptions(){var $selectedOption=$selectElement.find('option:selected');$searchLabel.text($selectedOption.text());$formElement.attr('action',$selectedOption.attr('data-search-url'));$autocompleteObj=$autocompleteObj||$searchInput.data('autocomplete');if($selectedOption.val()==='global'||isLocalSearchDisabled){setPropertiesOnInput(false);}else{setPropertiesOnInput(true);}}
function setPropertiesOnInput(enable){$inputResultLang.prop('disabled',enable);if($autocompleteObj){if(enable){$autocompleteObj.enable();}else{$autocompleteObj.disable();}}}
$(function(){setElements();if($selectElement){setFormOptions();$selectElement.on('change keyup keydown',function(){setFormOptions();}).on('focus',function(){$chevron.addClass('dark');}).on('blur',function(){$chevron.removeClass('dark');});}
if(browserDetect.isIOS7orLower()){$searchInput.on('focus',function(){scrollFix.scrollToTop($globalNav);}).on('blur',function(){scrollFix.restoreScrollY($globalNav);});}});});;$(function(){'use strict';var SearchSuggestions=(function(){function WikiaSearchApp(id){this.id=id;this.searchForm=$(id);this.searchField=$('#searchInput');this.searchSelect=$('#searchSelect');if(!this.searchForm.hasClass('noautocomplete')){this.searchField.bind({'suggestShow':window.transparentOut.show,'suggestHide':window.transparentOut.hide});this.searchField.one('focus',$.proxy(this.initSuggest,this));if(this.searchField.is(':focus')){this.initSuggest();}}}
WikiaSearchApp.prototype.track=Wikia.Tracker.buildTrackingFunction({trackingMethod:'internal'});WikiaSearchApp.prototype.initSuggest=function(){var autocompleteReEscape=new RegExp('(\\'+['/','.','*','+','?','|','(',')','[',']','{','}','\\'].join('|\\')+')','g');$.when(mw.loader.use('jquery.autocomplete')).then($.proxy(function(){this.searchField.autocomplete({serviceUrl:window.wgServer+window.wgScript+'?action=ajax&rs=getLinkSuggest&format=json',onSelect:$.proxy(function(value,data,event){var valueEncoded=encodeURIComponent(value.replace(/ /g,'_')),location=window.wgArticlePath.replace(/\$1/,valueEncoded).replace(encodeURIComponent('/'),'/');this.track({eventName:'search_start_suggest',sterm:valueEncoded,rver:0});if(event.button===1||event.metaKey||event.ctrlKey){window.open(location);return false;}else{window.location.href=location;}},this),appendTo:'.global-nav-search-input-wrapper',deferRequestBy:200,disabled:(this.searchSelect.val()==='global')?true:false,minLength:3,maxHeight:1000,selectedClass:'selected',width:'100%',fnFormatResult:function(value,data,currentValue){var pattern='('+currentValue.replace(autocompleteReEscape,'\\$1')+')';return'<span>'+
value.replace(new RegExp(pattern,'gi'),'<strong>$1<\/strong>')+'</span>';},skipBadQueries:true});},this));};return WikiaSearchApp;})();new SearchSuggestions('#searchForm');});;require(['jquery','GlobalNavigationiOSScrollFix','wikia.window','wikia.browserDetect'],function($,scrollFix,win,browserDetect){'use strict';var $entryPoint,$userLoginDropdown,loginAjaxForm=false;function openMenu(){$entryPoint.addClass('active');win.transparentOut.show();if(!loginAjaxForm){loginAjaxForm=new UserLoginAjaxForm($entryPoint,{skipFocus:true});UserLoginFacebook.init(UserLoginFacebook.origins.DROPDOWN);}
$('#globalNavigation').trigger('user-login-menu-opened');}
function closeMenu(){$entryPoint.removeClass('active');win.transparentOut.hide();}
function closeMenuIfNotFocused(){var id=document.activeElement.id;if(!(id==='usernameInput'||id==='passwordInput')){closeMenu();}}
$(function(){var $globalNav=$('#globalNavigation');win.transparentOut.bindClick(closeMenu);$entryPoint=$('#AccountNavigation');$entryPoint.on('click','.ajaxLogin',function(ev){ev.preventDefault();ev.stopImmediatePropagation();if($entryPoint.hasClass('active')){if(!!win.wgUserName){win.location=$(this).attr('href');}else{closeMenu();}}else{openMenu();}});$userLoginDropdown=$('#UserLoginDropdown');if(browserDetect.isIOS7orLower()){$userLoginDropdown.on('focus','#usernameInput, #passwordInput',function(){scrollFix.scrollToTop($globalNav);}).on('blur','#usernameInput, #passwordInput',function(){scrollFix.restoreScrollY($globalNav);});}
if(!win.Wikia.isTouchScreen()){win.delayedHover($entryPoint.get(0),{checkInterval:100,maxActivationDistance:20,onActivate:openMenu,onDeactivate:($userLoginDropdown.length?closeMenuIfNotFocused:closeMenu),activateOnClick:false});}});});;var UserLoginAjaxForm=function(el,options){'use strict';this.el=$(el);this.options=options||{};this.init();};UserLoginAjaxForm.prototype.init=function(){'use strict';this.form=this.el.find('form');this.wikiaForm=new WikiaForm(this.form);this.inputs={username:this.form.find('input[name=username]'),password:this.form.find('input[name=password]'),keeploggedin:this.form.find('input[name=keeploggedin]'),logintoken:this.form.find('input[name=loginToken]'),returnto:this.form.find('input[name=returnto]'),returntoquery:this.form.find('input[name=returntoquery]'),returntourl:this.form.find('input[name=returntourl]'),email:this.form.find('input[name=email]')};this.submitButton=this.form.find('input[type=submit]');this.forgotPasswordLink=this.form.find('.forgot-password');this.retrieveLoginToken();this.form.submit(this.submitLogin.bind(this));this.forgotPasswordLink.click(this.mailPassword.bind(this));if(!this.options.skipFocus){this.inputs.username.focus();}};UserLoginAjaxForm.prototype.submitLogin=function(e){'use strict';$(window).trigger('UserLoginSubmit');this.submitButton.attr('disabled','disabled');if(this.options.ajaxLogin){e.preventDefault();this.ajaxLogin();}};UserLoginAjaxForm.prototype.ajaxLogin=function(){'use strict';$.nirvana.postJson('UserLoginSpecial','login',{loginToken:this.loginToken,username:this.inputs.username.val(),password:this.inputs.password.val(),keeploggedin:this.inputs.keeploggedin.is(':checked')},this.submitLoginHandler.bind(this));};UserLoginAjaxForm.prototype.submitLoginHandler=function(json){'use strict';this.form.find('.error-msg').remove();this.form.find('.input-group').removeClass('error');var result=json.result,callback;if(result==='ok'){window.wgUserName=json.wgUserName;callback=this.options.callback||'';if(callback&&typeof callback==='function'){callback.bind(this,json)();}else{this.reloadPage();}}else if(result==='resetpass'){callback=this.options.resetpasscallback||'';if(callback&&typeof callback==='function'){callback.bind(this,json)();}else{$.post(wgScriptPath+'/wikia.php',{controller:'UserLoginSpecial',method:'changePassword',format:'html',username:this.inputs.username.val(),password:this.inputs.password.val(),returnto:this.inputs.returnto.val(),fakeGet:1},this.retrieveTemplateHandler.bind(this));}}else if(result==='unconfirm'){$.get(wgScriptPath+'/wikia.php',{controller:'UserLoginSpecial',method:'getUnconfirmedUserRedirectUrl',format:'json',username:this.inputs.username.val()},function(json){window.location=json.redirectUrl;});}else if(result==='closurerequested'){$.post(wgScriptPath+'/wikia.php',{controller:'UserLoginSpecial',method:'getCloseAccountRedirectUrl',format:'json'},function(data){window.location=data.redirectUrl;});}else{this.submitButton.removeAttr('disabled');this.errorValidation(json);}};UserLoginAjaxForm.prototype.retrieveTemplateHandler=function(html){'use strict';var content=$('<div style="display:none" />').append(html),form=this.form;form.slideUp(400,function(){form.replaceWith(content);content.slideDown(400);});};UserLoginAjaxForm.prototype.reloadPage=function(){'use strict';var location=window.location.href,delim='?';if(location.indexOf('?')>0){delim='&';}
window.location.href=location.split('#')[0]+delim+'cb='+Math.floor(Math.random()*10000);};UserLoginAjaxForm.prototype.errorValidation=function(json){'use strict';if(json.errParam){this.wikiaForm.showInputError(json.errParam,json.msg);}else{this.wikiaForm.showGenericError(json.msg);}};UserLoginAjaxForm.prototype.retrieveLoginToken=function(params){'use strict';params=params||{};if(!this.loginToken||params.clearCache){this.loginToken='retrieving';$.nirvana.postJson('UserLoginSpecial','retrieveLoginToken',{controller:'UserLoginSpecial',method:'retrieveLoginToken',format:'json'},function(res){this.loginToken=res.loginToken;this.inputs.logintoken.val(res.loginToken);}.bind(this));}};UserLoginAjaxForm.prototype.mailPassword=function(e){'use strict';e.preventDefault();this.form.find('.input-group').removeClass('error');this.form.find('.error-msg').remove();$.nirvana.postJson('UserLoginSpecial','mailPassword',{username:this.inputs.username.val()},this.mailPasswordHandler.bind(this));};UserLoginAjaxForm.prototype.mailPasswordHandler=function(json){'use strict';if(json.result==='ok'){this.errorValidation(json);}else if(json.result==='error'){this.errorValidation(json);}};;var WikiaForm=function(el){this.el=$(el);this.genericError=this.el.find('.general-errors');if(this.genericError.length==0){this.el.find('fieldset').prepend('<div class="input-group general-errors error"><div class="error-msg"></div></div>');this.genericError=this.el.find('.general-errors');this.genericError.hide();this.genericErrorMsg=this.genericError.find('.error-msg');}
this.genericSuccess=this.el.find('.general-success');if(this.genericSuccess.length==0){this.el.find('fieldset').prepend('<div class="input-group general-success success"><div class="success-msg"></div></div>');this.genericSuccess=this.el.find('.general-success');this.genericSuccess.hide();this.genericSuccessMsg=this.genericSuccess.find('.success-msg');}
this.inputs={};var inputs=this.el.find('input, select, textarea');for(var i=0;i<inputs.length;i++){var input=$(inputs[i]),name=input.attr('name');if(name){this.inputs[name]=input;}}
this.inputGroups={};this.el.find('[rel=tooltip]').tooltip();};WikiaForm.prototype.showGenericError=function(msg){this.genericError.show();this.showErrorMsg(this.genericError,msg);};WikiaForm.prototype.showGenericSuccess=function(msg){this.genericSuccess.show();this.showSuccessMsg(this.genericSuccess,msg);};WikiaForm.prototype.getInputGroup=function(paramName){var inputGroup=this.inputGroups[paramName];if(!inputGroup){inputGroup=this.inputs[paramName].closest('.input-group');if(!inputGroup.length!==0){var input=this.el.find('input[name='+paramName+']');if(input.length!==0){inputGroup=input.closest('.input-group');}}
if(inputGroup.length!==0){this.inputGroups[paramName]=inputGroup;}}
return inputGroup;};WikiaForm.prototype.showInputError=function(paramName,msg){var inputGroup=this.getInputGroup(paramName);if(inputGroup){inputGroup.addClass('error').removeClass('success');this.showErrorMsg(inputGroup,msg);}};WikiaForm.prototype.clearInputError=function(paramName){var inputGroup=this.getInputGroup(paramName);inputGroup.removeClass('error').addClass('success');this.clearErrorMsg(inputGroup);};WikiaForm.prototype.showErrorMsg=function(inputGroup,msg){var errorMsg=inputGroup.find('.error-msg');if(!errorMsg.length){errorMsg='<div class="error-msg"></div>';inputGroup.append(errorMsg);errorMsg=inputGroup.find('.error-msg');}
errorMsg.html(msg);};WikiaForm.prototype.showSuccessMsg=function(inputGroup,msg){var successMsg=inputGroup.find('.success-msg');if(!successMsg.length){successMsg='<div class="success-msg"></div>';inputGroup.append(successMsg);successMsg=inputGroup.find('.success-msg');}
successMsg.text(msg);};WikiaForm.prototype.clearErrorMsg=function(inputGroup){inputGroup.find('.error-msg').remove();};WikiaForm.prototype.clearSuccessMsg=function(inputGroup){inputGroup.find('.success-msg').remove();};WikiaForm.prototype.clearGenericError=function(inputGroup){inputGroup.hide().find('.error-msg').remove();};WikiaForm.prototype.clearGenericSuccess=function(inputGroup){inputGroup.hide().find('.success-msg').remove();};WikiaForm.prototype.clearAllInputErrors=function(){for(var key in this.inputGroups){this.clearInputError(key);}};;!function($){"use strict";var Tooltip=function(element,options){this.init('tooltip',element,options)}
Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut
this.type=type
this.$element=$(element)
this.options=this.getOptions(options)
this.enabled=true
if(this.options.trigger!='manual'){eventIn=this.options.trigger=='hover'?'mouseenter':'focus'
eventOut=this.options.trigger=='hover'?'mouseleave':'blur'
this.$element.on(eventIn,this.options.selector,$.proxy(this.enter,this))
this.$element.on(eventOut,this.options.selector,$.proxy(this.leave,this))}
this.options.selector?(this._options=$.extend({},this.options,{trigger:'manual',selector:''})):this.fixTitle()},getOptions:function(options){options=$.extend({},$.fn[this.type].defaults,options,this.$element.data())
if(options.delay&&typeof options.delay=='number'){options.delay={show:options.delay,hide:options.delay}}
return options},enter:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type)
if(!self.options.delay||!self.options.delay.show)return self.show()
clearTimeout(this.timeout)
self.hoverState='in'
this.timeout=setTimeout(function(){if(self.hoverState=='in')self.show()},self.options.delay.show)},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type)
if(this.timeout)clearTimeout(this.timeout)
if(!self.options.delay||!self.options.delay.hide)return self.hide()
self.hoverState='out'
this.timeout=setTimeout(function(){if(self.hoverState=='out')self.hide()},self.options.delay.hide)},show:function(){var $tip,inside,pos,actualWidth,actualHeight,placement,tp
if(this.hasContent()&&this.enabled){$tip=this.tip()
this.setContent()
if(this.options.animation){$tip.addClass('fade')}
placement=typeof this.options.placement=='function'?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement
inside=/in/.test(placement)
$tip.remove().css({top:0,left:0,display:'block'}).appendTo(inside?this.$element:document.body)
if(this.options&&this.options['z-index']){$tip.css('z-index',this.options['z-index']);}
pos=this.getPosition(inside)
actualWidth=$tip[0].offsetWidth
actualHeight=$tip[0].offsetHeight
switch(inside?placement.split(' ')[1]:placement){case'bottom':tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}
break
case'top':tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}
break
case'left':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}
break
case'right':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}
break
case'wikiaBar':tp={top:pos.top-actualHeight,right:0}
break
case'wikiaBarMessage':tp={top:pos.top-actualHeight,right:0}
break}
$tip.css(tp).addClass(placement).addClass('in')}},isHTML:function(text){return typeof text!='string'||(text.charAt(0)==="<"&&text.charAt(text.length-1)===">"&&text.length>=3)||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(text)},setContent:function(){var $tip=this.tip(),title=this.getTitle()
$tip.find('.tooltip-inner')[this.isHTML(title)?'html':'text'](title)
$tip.removeClass('fade in top bottom left right')},hide:function(){var that=this,$tip=this.tip()
$tip.removeClass('in')
function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).remove()},500)
$tip.one($.support.transition.end,function(){clearTimeout(timeout)
$tip.remove()})}
$.support.transition&&this.$tip.hasClass('fade')?removeWithAnimation():$tip.remove()
return this;},fixTitle:function(){var $e=this.$element
if($e.attr('title')||typeof($e.attr('data-original-title'))!='string'){$e.attr('data-original-title',$e.attr('title')||'').removeAttr('title')}},hasContent:function(){return this.getTitle()},getPosition:function(inside){return $.extend({},(inside?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var title,$e=this.$element,o=this.options
title=$e.attr('data-original-title')||(typeof o.title=='function'?o.title.call($e[0]):o.title)
return title},tip:function(){return this.$tip=this.$tip||$(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide()
this.$element=null
this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass('in')?'hide':'show']()}}
$.fn.tooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data('tooltip'),options=typeof option=='object'&&option
if(!data)$this.data('tooltip',(data=new Tooltip(this,options)))
if(typeof option=='string')data[option]()})}
$.fn.tooltip.Constructor=Tooltip
$.fn.tooltip.defaults={animation:true,placement:'top',selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:'hover',title:'',delay:0}}(window.jQuery);;