<html>
<head>
<title>SMTP: простой протокол передачи почты</title>
</head>

<body>
<div>


<p><small><a HREF="index.html"><img SRC="contents.jpg" BORDER="0" WIDTH="94" HEIGHT="20"></a><a HREF="../home.htm"><img SRC="begin.jpg" BORDER="0" WIDTH="68" HEIGHT="20"></a><a HREF="glava29.html"><img SRC="forward.jpg" BORDER="0" WIDTH="68" HEIGHT="20"></a><a HREF="glava27.html"><img SRC="back_b.jpg" BORDER="0" WIDTH="68" HEIGHT="20"></a><img SRC="index.jpg" WIDTH="68" HEIGHT="20"></small></p>

<b><font FACE="Arial" SIZE="4">



<p><a NAME="t280000"></a>Глава 28 SMTP: простой протокол

передачи почты</p>

</font><font FACE="Arial"><font size="3"><u>



<p><a NAME="t281000"></a>Введение</p>

</u></font></b>



<p><small>Электронная почта (e-mail), несомненно, одно из

самых популярных приложений. [<a NAME="t281001"></a>Caceres et

al. 1991] показывает, что примерно половина всех TCP

соединений занята передачей почтовых сообщений

с исполььзованием простого протокола передачи

почты (<a NAME="t281002"></a>SMTP - Simple Mail Transfer Protocol). (С точки

зрения количества переданных байт, по FTP

соединениям передается значительно больше

данных.) [<a NAME="t281003"></a>Paxson 1993] обнаружил, что

среднее почтовое сообщение содержит примерно 1500

байт данных, однако некоторые сообщения содержат

мегабайты данных, потому что электронная почта

иногда используется для посылки файлов. </small></p>



<p><small>На рисунке 28.1 показан обмен почтой с

использованием TCP/IP.<a NAME="t281004"></a></small></p>

</font>



<p ALIGN="CENTER"><small><img SRC="t28_1.jpg" WIDTH="460" HEIGHT="184"></small></p>

<font FACE="Arial">



<p ALIGN="CENTER"><small>Рисунок 28.1 Доставка электронной

почты в Internet.</small></p>



<p>&nbsp;</p>



<p><small>Пользователи общаются с <a NAME="t281005"></a>пользовательскими

агентами (user agent). В настоящее время существует

очень много реализаций пользовательских

агентов. Популярные пользовательские агенты для

Unix это MH, Berkeley Mail, Elm и Mush. </small></p>



<p><small>Обмен почтой с использованием TCP

осуществляется посредством агентов передачи

сообщений (<a NAME="t281006"></a>MTA - message transfer agent). Наиболее

распространенные MTA для Unix систем это Sendmail.

Пользователи обычно не общаются с MTA. В задачу

системного администратора входит установка

локального MTA. </small></p>



<p><small>В этой главе рассматривается обмен

электронной почтой между двумя MTA с

использованием TCP. Мы не будем рассматривать

функционирование или принципы работы

пользовательских агентов. </small></p>



<p><small>RFC 821 [<a NAME="t281007"></a>Postel 1982] описывает протокол

SMTP. А именно то, как два MTA общаются друг с другом

по TCP соединению. RFC 822 [<a NAME="t281008"></a>Crocker 1982]

приводит формат сообщения электронной почты,

которое передается между двумя MTA в соответствии

с RFC 821.</small></p>

<font size="3"><u><b>



<p><a NAME="t282000"></a>Протокол SMTP</p>

</b></u></font>



<p><small>При общении между двумя MTA используется <a NAME="t282001"></a>NVT ASCII. Команды посылаются клиентом

серверу, а сервер отвечает с помощью цифровых

кодов и опциональных текстовых строк (для чтения

человеком). Это несколько напоминает сценарий,

который мы видели для FTP в предыдущей главе. </small></p>




<p><small>Клиент может послать серверу небольшое

количество команд: меньше дюжины. (Для сравнения,

FTP имеет более сорока команд.) Вместо того чтобы

описывать команды одну за другой, мы начнем с

простого примера, для того чтобы показать что

происходит, когда отправляется почта.</small></p>

<font size="3"><i><b>



<p><a NAME="t282002"></a>Простой пример</p>

</b></i></font>



<p><small>Пошлем простое сообщение размером в одну

строку и посмотрим, как осуществляется SMTP

соединение. Для этого воспользуемся нашим

пользовательским агентом с флагом -v, который

передается транспортному агенту почты (Sendmail в

данном случае). Когда указан этот флаг, MTA

отображает все, что посылается и принимается по

SMTP соединению. Строки, начинающиеся с &gt;&gt;&gt;, это

команды, посылаемые SMTP клиентом, а строки,

начинающиеся с 3-циферного кода отклика, приходят

от SMTP сервера. Ниже приводится интерактивная

сессия:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

sun % <b>mail -v rstevens@noao.edu </b>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; запускаем

пользовательского агента<br>

To: rstevens@noao.edu

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; это

вывод от пользовательского агента<br>

Subject: <b>testing </b>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; затем

нас просят ввести тему сообщения<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; пользовательский

агент добавляет одну пустую строку между

заголовком и телом<br>

<b>1, 2, 3. </b>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; это

тело сообщения<br>

<b>. </b>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; вводим

точку в начале строки, сообщающую, что ввод

сообщения завершен<br>

<br>

Sending letter ... rstevens@noao.edu...

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; отладочный

вывод от пользовательского агента<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; следующий

вывод от MTA (Sendmail)<br>

Connecting to mailhost via ether...<br>

Trying 140.252.1.54... connected.<br>

220 noao.edu Sendmail 4.1/SAG-noao.G89 ready at Mon, 19 Jul 93 12:47:34 MST<br>

<br>

&gt;&gt;&gt; HELO sun.tuc.noao.edu.<br>

250 noao.edu Hello sun.tuc.noao.edu., pleased to meet you<br>

<br>

&gt;&gt;&gt; MAIL From:&lt;rstevens@sun.tuc.noao.edu&gt;<br>

250 &lt;rstevens@sun.tuc.noao.edu&gt;... Sender ok<br>


<br>

&gt;&gt;&gt; RCPT To:&lt;rstevens@noao.edu&gt;<br>

250 &lt;rstevens@noao.edu&gt;... Recipient ok<br>

<br>

&gt;&gt;&gt; DATA<br>

354 Enter mail, end with &quot;.&quot; on a line by itself<br>

<br>

&gt;&gt;&gt; .<br>

250 Mail accepted<br>

<br>

&gt;&gt;&gt; QUIT<br>

221 noao.edu delivering mail<br>

<br>

rstevens@noao.edu... Sent<br>

sent.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; это

вывод от пользовательского агента<br>

</p>

</font><font FACE="Arial">



<p>&nbsp;</p>



<p><small>Для отправки почты было использовано всего

пять SMTP команд: HELO, MAIL, RCPT, DATA и QUIT. </small></p>



<p><small>Команда mail запускает пользовательского

агента. Затем необходимо ввести тему сообщения,

после чего можно печатать тело сообщения. Ввод

точки в начале строки завершает сообщение, и

пользовательский агент передает почту в MTA для

доставки. </small></p>



<p><small>Клиент осуществляет активное открытие на TCP

порт 25, после чего ожидает приветственного

сообщения (отклик с кодом 220) от сервера. Ответ

сервера должен начинаться с полного имени домена

хоста сервера: noao.edu в данном примере. (Обычно

вместе с цифровым кодом отклика возвращается

необязательный текст. Здесь требуется имя

домена.) </small></p>



<p><small>Затем клиент идентифицирует себя с

использованием команды HELO. В качестве аргумента

указывается полное имя домена хоста клиента:

sun.tuc.noao.edu. </small></p>



<p><small>Команда MAIL идентифицирует автора сообщения

(или отправителя). Следующая команда, RCPT,

идентифицирует получателя. Если сообщение

предназначено нескольким получателям, может

быть исполнено несколько команд RCPT. </small></p>



<p><small>Клиент отправляет содержимое почтового

сообщения с использованием команды DATA. Строка,

содержащая только точку, указывает на конец

сообщения. Последняя команда, QUIT, прекращает

обмен почтой. </small></p>



<p><small>На рисунке 28.2 приведена временная

диаграмма SMTP соединения между отправителем SMTP

(клиент) и получателем SMTP (сервер). Мы удалили все

связанное с установлением и разрывом соединения,

а также объявления размера окна. </small></p>



<p><small>В этом примере пользовательский агент

отправляет сообщение длиной в одну строку (&quot;1, 2,

3.&quot;), однако в сегменте 12 передается 393 байта

данных. Следующие 12 строк включают в себя 393

байта, которые были посланы <a NAME="t282003"></a>клиентом:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

Received: by sun.tuc.noao.edu. (4.1/SMI-4.1)<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; id AA00502; Mon, 19 Jul 93 12:47:32

MST<br>

Message-Id: &lt;9307191947.AA00502@sun.tuc.noao.edu.&gt;<br>

From: rstevens@sun.tuc.noao.edu (Richard Stevens)<br>

Date: Mon, 19 Jul 1993 12:47:31 -0700<br>

Reply-To: rstevens@noao.edu<br>

X-Phone: +1 602 676 1676<br>

X-Mailer: Mail User's Shell (7.2.5 10/14/92)<br>

To: rstevens@noao.edu<br>

Subject: testing<br>

<br>

1, 2, 3.<br>

</p>



<p>&nbsp;</p>

</font>



<p ALIGN="CENTER"><small><img SRC="t28_2.jpg" WIDTH="506" HEIGHT="660"></small></p>

<font FACE="Arial">



<p ALIGN="CENTER"><small>Рисунок 28.2 Принцип доставки почты

SMTP.</small></p>



<p>&nbsp;</p>



<p><small>MTA добавляет первые три строки, а также Received:

и Message-Id:, а следующие девять строк генерируются

пользовательским агентом.</small></p>

<font size="3"><i><b>



<p><a NAME="t282004"></a>SMTP команды</p>

</b></i></font>



<p><small>Минимальные SMTP реализации поддерживают

восемь команд. Мы видели пять из них в предыдущем

примере: HELO, MAIL, RCPT, DATA и QUIT. </small></p>



<p><small>Команда RSET прекращает текущую передачу


почты и заставляет оба конца &quot;сброситься&quot;.

Любая сохраненная информация об отправителе,

получателе или содержимое почты уничтожается. </small></p>



<p><small>Команда VRFY позволяет клиенту попросить

отправителя проверить адрес получателя, не

отправляя ему почту. Этим часто пользуются

системные администраторы, чтобы вручную

определить проблемы с доставкой почты. Мы увидим,

как это делается, в следующем разделе. </small></p>



<p><small>Команда NOOP не делает ничего, однако

заставляет сервер ответить, что все нормально, а

именно откликом с кодом 200. </small></p>



<p><small>Существуют также дополнительные,

необязательные команды. EXPN расширяет список

почты и часто используется системными

администраторами, так же как и VRFY. Более того,

большинство версий Sendmail обрабатывают эти две

команды одинаково.</small></p>



<p>&nbsp;</p>

<font size="1">



<p></font><font size="2"><font color="#0000A0">Версия 8 Sendmail в <a NAME="t282005"></a>4.4BSD больше не обрабатывает одинаково

эти две команды. VRFY не расширяет псевдонимы и не

отслеживает файлы <a NAME="t282006"></a>.forward.</font></p>

</font>



<p>&nbsp;</p>



<p><small>Команда TURN позволяет клиенту и серверу

поменяться ролями, чтобы послать почту в

обратном направлении, не разрывая TCP соединение и

не создавая новое. (Sendmail не поддерживает эту

команду.) Существуют еще три команды (SEND, SOML и SAML),

которые очень редко реализуются и призваны

заменить собой команду MAIL. Эти три команды в

своих комбинациях позволяют доставлять почту

непосредственно на пользовательский терминал

(если пользователь находится терминалом в

системе) или складывать ее в почтовый ящик

получателя.</small></p>

<font size="3"><i><b>



<p>Конверты, заголовки и тело</p>

</b></i></font>



<p><small>Электронная почта состоит из трех частей.</small>



<ol>

  <li><small><a NAME="t282007"></a>Конверт используется MTA для

    доставки. В нашем примере конверт был указан

    двумя SMTP командами:</small></font><font FACE="Courier New" size="1"><p></font><font FACE="Courier New" size="2">MAIL From:&lt;rstevens@sun.tuc.noao.edu&gt;<br>

    RCPT To:&lt;rstevens@noao.edu&gt;</p>

    </font><font FACE="Arial"><p><small>RFC 821 определяет содержимое и

    интерпретацию конверта, а также протокол,

    который используется для обмена почтой по TCP

    соединению.</small></p>

  </li>

  <li><small><a NAME="t282008"></a>Заголовки используются

    пользовательскими агентами. В примере мы видели

    девять полей заголовков: Received, Message-Id, From, Date, Reply-To,

    X-Phone, X-Mailer, To и Subject. Каждое поле заголовка

    содержит имя, после которого следует двоеточие, а

    затем следует значение этого поля. RFC 822

    определяет формат и интерпретацию полей

    заголовка. (Заголовки, начинающиеся с X-, это поля,

    определяемые пользователем. Другие определены в

    RFC 822.) Длинные поля заголовков, такие как Received в

    примере, могут быть разбиты на несколько строк,

    причем дополнительные строки начинаются с

    пробела.</small></li>

  <li><small><a NAME="t282009"></a>Тело это содержимое сообщения

    от отправителя к получателю. RFC 822 определяет тело

    сообщения как текстовые строки в формате <a NAME="t282010"></a>NVT ASCII. Когда происходит передача с

    использованием команды DATA, заголовки передаются

    первыми, за ними следует пустая строка и затем


    следует тело сообщения. Каждая строка,

    передаваемая с использованием команды DATA, должна

    меньше чем 1000 байт.</small></li>

</ol>



<p>&nbsp;</p>



<p><small>Затем пользовательский агент берет то, что

было указано в качестве тела сообщения,

добавляет некоторые заголовки и передает

результат в MTA. MTA добавляет свои заголовки,

добавляет конверт и посылает результат другому

MTA. </small></p>



<p><small>Термин <a NAME="t282011"></a>содержимое часто

используется, чтобы описать комбинацию

заголовков и тела. Содержимое посылается

клиентом с использованием команды DATA.</small></p>

<font size="3"><i><b>



<p><a NAME="t282012"></a>Транслирующие агенты</p>

</b></i></font>



<p><small>Первая информационная строка от локального

MTA в примере была следующей: &quot;Connecting to mailhost via

ether&quot;. </small></p>



<p><small>Это объясняется тем, что система автора

сконфигурирована таким образом, чтобы посылать

всю нелокальную исходящую почту на

транслирующую машину для дальнейшей доставки.

Так сделано по двум причинам. Во-первых,

упрощается конфигурацию всех MTA, кроме MTA

транслирующей системы. (Конфигурация MTA не

проста, каждый, кто когда-либо работал с Sendmail,

может это подтвердить.) Во-вторых, одна система в

организации может выступать в роли почтового

ретранслятора, возможно пряча тем самым все

остальные индивидуальные системы. </small></p>



<p><small>В нашем примере транслирующая система

имеет имя хоста mailhost в локальном домене (.tuc.noao.edu),

а все индивидуальные системы сконфигурированы

таким образом, чтобы посылать свою почту на этот

хост. Мы можем исполнить команду <a NAME="t282013"></a>host,

чтобы посмотреть, как это имя <a NAME="t282014"></a><a NAME="t282015"></a>определено в DNS:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

sun % <b>host mailhost</b><br>

mailhost.tuc.noao.edu CNAME noao.edu

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; каноническое

имя<br>

noao.edu A 140.252.1.54

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ее

реальный IP адрес<br>

</p>

</font><font FACE="Arial">



<p>&nbsp;</p>



<p><small>Если хост, который используется в качестве

ретранслирующего, в будущем изменится,

необходимо только сменить его DNS имя -

конфигурация почты всех индивидуальных систем

не изменится. </small></p>



<p><small>Большинство организаций в настоящее время

используют транслирующие системы. На рисунке 28.3

показана упрощенная схема почты в Internet

(рисунок&nbsp;28.2), причем сделано предположение, что

большинство отправляющих хостов и окончательные

получающие хосты используют транслирующие

хосты. </small></p>



<p><small>Между отправителем и получателем

присутствует четыре MTA. Локальный MTA на хосте

отправителя просто доставляет почту на свой

транслирующий MTA. (Этот транслирующий MTA должен

иметь имя mailhost в домене организации.) Здесь SMTP

использует локальные сети организации. Затем

транслирующий MTA организации отправителя

посылает почту по Internet на транслирующий MTA

организации получателя. Другие транслирующие MTA

доставляют почту на хост получателя после

общения с локальными MTA хоста получателя. Все MTA в

примере используют SMTP, хотя существует

возможность того, что на этом пути могут

встретиться и другие протоколы доставки.</small></p>

<font size="3"><i><b>



<p>NVT ASCII</p>

</b></i></font>



<p><small>Одна из характеристик SMTP заключается в том,

что он использует NVT <a NAME="t282016"></a>ASCII абсолютно

везде: в конверте, заголовке и теле сообщения. Как

мы сказали в разделе <a HREF="glava26.html#t264000">&quot;Протокол

Telnet&quot;</a> главы 26, NVT ASCII это 7-битная кодировка

символов, символы при этом передаются как

8-битные байты, у которых старший бит установлен в

0.<a NAME="t282017"></a></small></p>

</font>



<p ALIGN="CENTER"><small><img SRC="t28_3.jpg" WIDTH="511" HEIGHT="614"></small></p>

<font FACE="Arial">



<p ALIGN="CENTER"><small>Рисунок 28.3 Электронная почта по

Internet с транслирующими системами на обоих концах.</small></p>



<p>&nbsp;</p>



<p><small>В разделе <a HREF="#t284000">&quot;Будущее SMTP&quot;</a>

этой главы мы обсудим некоторые более новые

характеристики почты в Internet, расширенный SMTP и

мультимедийную почту (MIME), которая позволяет

отправлять и принимать звуковую и видео

информацию. Мы увидим, что MIME использует NVT <a NAME="t282018"></a>ASCII в качестве конверта, заголовка и

тела, а изменения касаются только

пользовательских агентов.</small></p>

<font size="3"><i><b>



<p><a NAME="t282019"></a>Интервалы между ретрансляциями</p>

</b></i></font>



<p><small>Когда пользовательский агент передает

новое почтовое сообщение своему MTA, попытка

доставить сообщение обычно осуществляется

немедленно. Если доставить сообщение не удалась,

MTA поставит сообщение в очередь и повторит

попытку позже. </small></p>



<p><small>Требования к хостам <a NAME="t282020"></a>Host Requirements RFC

рекомендует устанавливать первоначальный

тайм-аут по крайней мере в 30 минут. Отправитель

должен повторять свои попытки по меньшей мере 4-5

дней. Более того, если сбои в доставке происходят

часто (получатель вышел из строя или произошла

временная потеря сетевого соединения), имеет

смысл делать две попытки установить соединение в

течение первого часа, когда сообщение находится

в очереди.</small></p>

<font size="3"><u><b>



<p><a NAME="t283000"></a>Примеры SMTP</p>

</b></u></font>



<p><small>В предыдущем разделе показана обычная

доставка почты; сейчас рассмотрим, как для

доставки почты записи используются MX, а также


проиллюстрируем работу команд VRFY и EXPN.</small></p>

<font size="3"><i><b>



<p><a NAME="t283001"></a>Записи MX: хост не подключен

непосредственно к Internet</p>

</b></i></font>



<p><small>В разделе <a HREF="glava14.html#t146000">&quot;Записи

ресурсов&quot;</a> главы 14 мы сказали, что один из

типов записи ресурса в DNS используется для обмена

почты и называется записями MX. В следующем

примере мы покажем, как используются записи MX,

для отправки почты на хосты, не подключенные к

Internet непосредственно. RFC 974 [<a NAME="t283002"></a>Partridge 1986]

описывает, как MTA обрабатывает записи MX. </small></p>



<p><small>Хост mlfarm.com не подключен к Internet, однако имеет

MX запись, указывающую на перенаправителя почты,

который, в свою очередь, находится в Internet:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

sun % <b>host -a -v -t mx mlfarm.com</b><br>

The following answer is not authoritative:<br>

mlfarm.com

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86388

&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MX

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10 mercury.hsi.com<br>

mlfarm.com

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86388

&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MX

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 15 hsi86.hsi.com<br>

Additional information:<br>

mercury.hsi.com

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86388

&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 143.122.1.91<br>

hsi86.hsi.com

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 172762

&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; A

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 143.122.1.6<br>

</p>

</font><font FACE="Arial">



<p>&nbsp;</p>



<p><small>Здесь показаны две записи MX, каждая с

различной степенью предпочтительности. Мы

ожидаем, что MTA начнет с меньшего из двух <a NAME="t283003"></a>значений предпочтительности. </small></p>



<p><small>Следующий скрипт показывает, как почта

будет послана этому хосту:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

sun % <b>mail -v ron@mlfarm.com </b>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; флаг

-v, чтобы посмотреть, что делает MTA<br>

To: ron@mlfarm.com<br>

Subject: <b>MX test message</b><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; здесь

печатается тело сообщения (не показано)<br>

.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; точка

в конце строки завершает сообщение<br>

Sending letter ... ron@mlfarm.com...<br>

Connecting to mlfarm.com via tcp...<br>

mail exchanger is mercury.hsi.com

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; найдена

запись MX<br>

Trying 143.122.1.91... connected.

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; делается

первая попытка с минимальной

предпочтительностью<br>

220 mercury.hsi.com ...<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; здесь

происходит обычная доставка почты SMTP<br>

</p>

</font><font FACE="Arial">



<p>&nbsp;</p>



<p><small>MTA определил, что хост назначения имеет MX

запись и использует MX запись с минимальным

значением предпочтительности. </small></p>



<p><small>Перед запуском этого примера на хосте sun

была изменена конфигурация таким образом, чтобы

при отправке почты не использовался обычный

транслирующий хост, поэтому мы видим обмен

почтой с хостом назначения. Также в конфигурации

было сказано использовать DNS сервер на хосте noao.edu

(к которому можно получить доступ через SLIP канал

с дозвоном). Благодаря этому, с использованием <a NAME="t283004"></a>tcpdump, мы можем посмотреть и передачу

почты, и DNS траффик на SLIP канале. На рисунке 28.4

показана начальная часть вывода команды tcpdump.<a NAME="t283005"></a></small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

1&nbsp; 0.0

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun.1624

&gt; noao.edu.53: 2+ MX? mlfarm.com. (28)<br>

2&nbsp; 0.445572 (0.4456)

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; noao.edu.53 &gt; sun.1624: 2*

2/0/2 MX <br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mercury.hsi.com.

10 (113)<br>

3&nbsp; 0.505739 (0.0602)

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun.1143 &gt;

mercury.hsi.com.25: S 1617536000:1617536000(0) <br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; win

4096<br>

4&nbsp; 0.985428 (0.4797)

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mercury.hsi.com.25 &gt;

sun.1143: S 1832064000:1832064000(0) <br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ack

1617536001 win 16384<br>

5&nbsp; 0.986003 (0.0006)

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sun.1143 &gt;

mercury.hsi.com.25: . ack 1 win 4096<br>

6&nbsp; 1.735360 (0.7494)

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mercury.hsi.com.25 &gt;

sun.1143: P 1:90(89) ack 1 win 16384<br>

</p>

</font><font FACE="Arial">



<p>&nbsp;</p>



<p><small>Рисунок 28.4 Посылка почты на хост, который

использует MX записи.</small></p>



<p>&nbsp;</p>



<p><small>В строке 1 MTA запрашивает свой DNS сервер о MX

записи для mlfarm.com. Знак плюс, следующий за 2,

означает, что установлен флаг &quot;необходима

рекурсия&quot;. Отклик в строке 2 имеет

установленным бит полномочности (звездочка,

следующая за 2) и содержит 2 записи ресурса (RR)

ответа (два имени MX хостов), 0 записей ресурса RR

прав доступа и две дополнительные RR (IP адреса

двух хостов). </small></p>



<p><small>В строках 3-5 устанавливается TCP соединение с

SMTP сервером на хосте mercury.hsi.com. Первоначальный

отклик сервера (220) показан в строке 6. </small></p>



<p><small>Каким-либо образом хост mercury.hsi.com должен

доставить это почтовое сообщение в пункт

назначения - mlfarm.com. Протокол <a NAME="t283006"></a>UUCP

является распространенным способом обмена

почтой с MX узлами для систем, которые не

подключены к Internet. </small></p>



<p><small>В этом примере MTA запрашивает <a NAME="t283007"></a>MX

запись, получает ее и посылает почту. К сожалению,

взаимодействие между MTA и DNS может отличаться в

зависимости от реализации. RFC 974 указывает, что MTA

должен сначала запросить MX записи, и если они не

найдены, попробовать доставить почту на хост


назначения (то есть запросить DNS на предмет

записи A для хоста, его IP адрес). MTA должен также

поинтересоваться записями <a NAME="t283008"></a>CNAME в DNS

(канонические имена). </small></p>



<p><small>Например, если мы пошлем почту хосту

rstevens@mailhost.tuc.noao.edu с <a NAME="t283009"></a>BSD/386 хоста, MTA (Sendmail)

проделает следующее. </small></p>



<p><small>&nbsp;</small> 



<ol>

  <li><small>Sendmail запрашивает DNS, существуют ли записи CNAME

    для хоста mailhost.tuc.noao.edu. Мы видим, что записи CNAME

    существуют:</small></font><font FACE="Courier New" size="1"><p></font><font FACE="Courier New" size="2">sun % <b>host -t cname mailhost.tuc.noao.edu<br>

    </b>mailhost.tuc.noao.edu CNAME noao.edu</font><font FACE="Courier New" size="1"></p>

  </li>

  </font><font FACE="Arial">

  <li><small>Делается DNS запрос о существовании записи

    CNAME для noao.edu, в отклике сообщается, что записи не

    существует.</small></li>

  <li><small>Затем Sendmail запрашивает DNS о существовании MX

    записей для noao.edu и получает одну MX запись:</small></font><font FACE="Courier New" size="1"><p></font><font FACE="Courier New" size="2">sun % <b>host -t

    mx noao.edu<br>

    </b>noao.edu MX noao.edu</font><font FACE="Courier New" size="1"></p>

  </li>

  </font><font FACE="Arial">

  <li><small>Sendmail запрашивает DNS о существовании записей

    A (IP адрес) для noao.edu и получает значение 140.252.1.54.

    (Возможно, эта A запись была возвращена DNS

    сервером для noao.edu как дополнительная запись

    ресурса (RR) с MX откликом в шаге 3.)</small></li>

  <li><small>Открывается SMTP соединение на адрес 140.252.1.54, и

    почта отправляется.</small></li>

</ol>



<p>&nbsp;</p>



<p><small>Запрос CNAME не осуществляется для данных,

возвращенных в MX записи (noao.edu). Данные в MX записи

не могут быть псевдонимами - они должны быть

именем хоста, который имеет запись A.</small></p>



<p>&nbsp;</p>

<font size="1">



<p></font><font size="2"><font color="#0000A0">Версия Sendmail,

распространяемая с SunOS.4.1.3, обращается к DNS только

с запросами о существовании MX записей и сразу

прекращает все попытки, если MX запись не найдена.</font></p>

</font>



<p>&nbsp;</p>

<font size="3"><i><b>



<p>MX записи: хосты, которые выключены</p>

</b></i></font>



<p><small>Другое использование MX записи заключается

в том, чтобы найти альтернативного получателя


почты, если хост назначения выключен. Если мы

посмотрим DNS записи для нашего хоста sun, то увидим,

что он имеет две MX записи:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

sun % <b>host -a -v -t mx sun.tuc.noao.edu</b><br>

sun.tuc.noao.edu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86400

&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp; MX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0

sun.tuc.noao.edu<br>

sun.tuc.noao.edu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86400

&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp; MX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 10 noao.edu<br>

Additional information:<br>

sun.tuc.noao.edu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86400

&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp; A

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 140.252.1.29<br>

sun.tuc.noao.edu&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86400

&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp; A

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 140.252.13.33<br>

noao.edu

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 86400

&nbsp;&nbsp;&nbsp; IN&nbsp;&nbsp;&nbsp;&nbsp; A

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 140.252.1.54<br>

</p>

</font><font FACE="Arial">



<p>&nbsp;</p>



<p><small>MX запись с минимальным уровнем

предпочтительности указывает, что сначала надо

попробовать доставить почту непосредственно на

хост. Следующее значение предпочтительности

указывает на необходимость осуществить доставку

почты на хост <a NAME="t283010"></a>noao.edu. </small></p>



<p><small>В следующем скрипте мы посылаем почту сами

себе на хост sun.tuc.noao.edu, с хоста vangogh.cs.berkeley.edu,

предварительно выключив SMTP сервер назначения.

Когда на порт 25 прибывает запрос на соединение, TCP

должен ответить сбросом (RST), так как не

существует процесса, который может осуществить

пассивное открытие для этого порта.</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

vangogh % <b>mail -v rstevens@sun.tuc.noao.edu<br>

A test to a host that's down.<br>

.</b><br>

EOT<br>

<br>

rstevens@sun.tuc.noao.edu...Connecting to sun.tuc.noao.edu.(smtp)...<br>

rstevens@sun.tuc.noao.edu...Connecting to noao.edu.(smtp)...<br>

<br>

220 noao.edu ...<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; дальше

идет обычная передача почты SMTP<br>

</p>



<p>&nbsp;</p>

</font><font FACE="Arial">



<p><small>Мы видим, что MTA старается установить

контакт с sun.tuc.noao.edu, затем прекращает попытки и

устанавливает контакт с noao.edu. </small></p>



<p><small>На рисунке 28.5 показан вывод команды tcpdump,

где показано, как TCP отвечает сбросом (RST) на

входящие SYN.<a NAME="t283011"></a></small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

1&nbsp; 0.0

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vangogh.3873

&gt; 140.252.1.29.25: S 2358303745:2358303745(0) ...<br>

2&nbsp; 0.000621 (0.0006)&nbsp;&nbsp;&nbsp;&nbsp; 140.252.1.29.25 &gt; vangogh.3873: R

0:0(0) ack 2358303746 win 0<br>

<br>

3&nbsp; 0.300203 (0.2996)&nbsp;&nbsp;&nbsp;&nbsp; vangogh.3874 &gt; 140.252.13.33.25: S

2358367745:2358367745(0) ...<br>

4&nbsp; 0.300620 (0.0004)&nbsp;&nbsp;&nbsp;&nbsp; 140.252.13.33.25 &gt; vangogh.3874: R

0:0(0) ack 2358367746 win 0<br>

</p>

</font><font FACE="Arial">



<p>&nbsp;</p>



<p><small>Рисунок 28.5 Попытки установить контакт с

неработающим SMTP сервером.</small></p>



<p>&nbsp;</p>



<p><small>В строке 1 vangogh отправляет SYN на порт 25 на


первый IP адрес хоста sun: 140.252.1.29. В строке 2 мы видим

отказ. SMTP клиент на vangogh пробует следующий IP адрес

sun: 140.252.13.33 (строка 3), что также вызывает возврат RST

(строка 4). </small></p>



<p><small>SMTP клиент не старается изменить свое

поведение в результате ошибки, полученной на

активное открытие, которое он осуществлял в

строке 1, именно поэтому он старается обратиться

к другому IP адресу в строке 2. Если ошибка была

подобна &quot;хост недоступен&quot; (host unreachable) для

первой попытки, возможно, что вторая попытка


сработает. </small></p>



<p><small>Если причина, по которой активное открытие

SMTP клиента не сработало, заключается в том, что

хост выключен, мы увидим, что клиент будет

повторно выдавать SYN на IP адрес 140.252.1.29 в течение 75

секунд (примерно так же, как на <a HREF="glava18.html#t183002">рисунке

18.6</a>), затем отправит еще три SYN на IP адрес 140.252.13.33

в течение других 75 секунд. После 150 секунд клиент


перейдет к следующей MX записи с более высоким

значением предпочтительности.</small></p>

<font size="3"><i><b>



<p>Команды VRFY и EXPN</p>

</b></i></font>



<p><small>Команда <a NAME="t283012"></a>VRFY проверяет, в порядке

ли адрес получателя, не посылая при этом реальной

почты. <a NAME="t283013"></a>EXPN предназначена для

расширения почтового псевдонима до почтового

адреса. Большинство SMTP реализаций (такие как

Sendmail) воспринимают эти команды абсолютно

одинаково, однако мы уже отмечали, что более

новые версии Sendmail проводят различие между ними. </small></p>



<p><small>В качестве простого теста мы можем

подсоединиться к более новой версии Sendmail и

посмотреть эти различия. (Мы удалили вывод

клиента Telnet.)</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

sun % <b>telnet vangogh.cs.berkeley.edu 25</b><br>

220-vangogh.CS.Berkeley.EDU Sendmail 8.1C/6.32 ready at Tue, 3 Aug 1993 14:59:12 -0700<br>

220 ESMTP spoken here<br>

<br>

<b>helo bsdi.tuc.noao.edu</b><br>

250 vangogh.CS.Berkeley.EDU Hello sun.tuc.noao.edu [140.252.1.29], pleased to meet you<br>

<br>

<b>vrfy nosuchname</b><br>

550 nosuchname... User unknown<br>

<br>

<b>vrfy rstevens</b><br>

250 Richard Stevens &lt;rstevens@vangogh.CS.Berkeley.EDU&gt;<br>

<br>

<b>expn rstevens</b><br>

250 Richard Stevens &lt;rstevens@noao.edu&gt;<br>

</p>



<p>&nbsp;</p>

</font><font FACE="Arial">



<p><small>Во-первых, обратите внимание на то, что мы

специально напечатали неверное имя хоста для

команды HELO: bsdi вместо sun. Большинство SMTP серверов

берут IP адрес клиента и осуществляют запрос

указателя DNS (глава 14, раздел <a HREF="glava14.html#t145000">&quot;Запросы

указателя&quot;</a>), после чего сравнивают имена

хостов. Это позволяет серверу зарегистрировать

соединение клиента, основываясь на его IP адресе,

а не на имени, которое пользователь может указать

неверно. Некоторые серверы отвечают

юмористическими сообщениями, такими как &quot;вы

шарлатан&quot; или &quot;почему бы вам не позвонить

самому себе...&quot;. В этом примере мы видели, что

сервер просто напечатал реальное имя домена из

запроса указателя вместе с IP адресом. </small></p>



<p><small>Затем мы вводим команду VRFY для

несуществующего имени, на что сервер отвечает

ошибкой 550. Затем мы печатаем существующее имя, а

сервер отвечает именем пользователя на

локальном хосте. Затем мы пробуем команду EXPN и

получаем другой отклик. Команда EXPN определяет,


что почта для этого пользователя будет

перенаправлена и печатает адрес

перенаправления. </small></p>



<p><small>На многих хостах команды VRFY и EXPN отключены,

может быть с точки зрения секретности и иногда

из-за того, что администраторы считают, что в этом

находится какая-то дырка в секретности. Например,

мы можем попробовать воспользоваться этими

командами на SMTP сервере Белого Дома (США):</small></p>




<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

sun % <b>telnet whitehouse.gov 25</b><br>

220 whitehouse.gov SMTP/smap Ready.<br>

<br>

<b>helo sun.tuc.noao.edu</b><br>

250 (sun.tuc.noao.edu) pleased to meet you.<br>

<br>

<b>vrfy clinton</b><br>

500 Command unrecognized<br>

<br>

<b>expn clinton</b><br>

500 Command unrecognized<br>

</p>



<p>&nbsp;</p>

</font><font FACE="Arial"><font size="3"><u><b>



<p><a NAME="t284000"></a>Будущее SMTP</p>

</b></u></font>



<p><small>В настоящее время почта Internet заметно

меняется. Вспомните, что почта Internet состоит из

трех частей: конверт, заголовки и тело сообщения.

Появляются новые SMTP команды, которые изменяют

конверт, в заголовках могут быть использованы

не-ASCII символы, а к телу добавляются структуры

(MIME). В этом разделе мы по порядку рассмотрим

расширение каждой из трех частей.</small></p>

<font size="3"><i><b>



<p>Изменения в конверте: расширенное SMTP</p>

</b></i></font>



<p><small>RFC 1425 [<a NAME="t284001"></a>Klensin et al. 1993a] определяет

основные расширения для SMTP. В результате

получилось то, что называется <a NAME="t284002"></a>расширенным

SMTP (ESMTP - extended SMTP). Как и другие новые

характеристики (уже описанные в тексте), эти

изменения добавляются таким образом, что новые

версии совместимы со старыми. </small></p>



<p><small>Клиент, которому необходимо использовать

новые характеристики, открывает сессию с

сервером с использованием команды EHLO вместо

команды HELO. Совместимый сервер отвечает откликом

с кодом 250. Этот отклик обычно содержит несколько

строк, причем каждая строка содержит ключевое

слово и дополнительный аргумент. Ключевые слова

указывают на расширения SMTP, поддерживаемые

сервером. (В случае многострочного отклика во

всех строках кроме последней, между цифровым

кодом и текстом стоит дефис. В последней строке

между цифровым кодом и текстом стоит пробел.)

Вновь появляющиеся расширения будут описаны в RFC

и будут зарегистрированы в <a NAME="t284003"></a>IANA. </small></p>



<p><small>Ниже показаны начальные стадии соединений

с четырьмя SMTP серверами, три из которых

поддерживают расширенный SMTP. Соединение

осуществляется с помощью Telnet, однако весь вывод

Telnet клиента удален.</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="1">



<p></font><font FACE="Courier New" size="2">sun % <b>telnet vangogh.cs.berkeley.edu 25<br>

</b>220-vangogh.CS.Berkeley.EDU Sendmail 8.1C/6.32 ready at Mon, 2 Aug 1993 15:47:48 -0700<br>

220 ESMTP spoken here<br>

<br>

<b>ehlo sun.tuc.noao.edu<br>

</b>250-vangogh.CS.Berkeley.EDU Hello sun.tuc.noao.edu [140.252.1.29], pleased to meet you<br>

250-EXPN<br>

250-SIZE<br>

250 HELP</p>

</font><font FACE="Arial">



<p>&nbsp;</p>



<p><small>Этот сервер выдает многострочный отклик 220

в виде приветственного сообщения. Расширенные

команды, приведенные в отклике 250, на команду EHLO

это EXPN, SIZE и HELP. Первая и последняя из исходной

спецификации RFC 821, однако они являются

дополнительными командами (необязательными).

Сервера ESMTP помимо дополнительных команд из RFC 821

поддерживают также и более новые команды. </small></p>



<p><small>Ключевое слово SIZE означает, что сервер

поддерживает то, что описано в RFC 1427 <a NAME="t284004"></a>[Klensin,

Freed, and Moore 1993]. Подобное расширение позволяет

клиенту указывать размер сообщения в байтах в

командной строке MAIL FROM. Это позволяет серверу

проверить, что он воспримет сообщение

определенного размера, перед тем как клиент

начнет его посылать. Эта команда была добавлена,

так как в последнее время появляется все больше

почтовых сообщений содержащих не-ASCII строки

(например, бинарные или звуковые файлы). </small></p>



<p><small>Следующий хост также поддерживает ESMTP.

Отклик 250 указывает, что поддерживаемое ключевое

слово SIZE содержит дополнительный аргумент. Он

указывает на то, что этот сервер может

воспринимать сообщения размером до 461 мегабайта.</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="1">



<p></font><font FACE="Courier New" size="2">sun % <b>telnet ymir.claremont.edu 25<br>

</b>220 ymir.claremont.edu -- Server SMTP (PMDF V4.2-13 #4220)<br>

<br>

<b>ehlo sun.tuc.noao.edu<br>

</b>250-ymir.claremont.edu<br>

250-8BITMIME<br>

250-EXPN<br>

250-HELP<br>

250-XADR<br>

250 SIZE 461544960</font><font FACE="Arial">&nbsp;</p>



<p>&nbsp;</p>



<p><small>Ключевое слово 8BITMIME определено в RFC 1426 [Klensin

et al. 1993b]. Оно позволяет клиенту добавить ключевое

слово BODY к команде MAIL FROM, указывая тем самым,

содержит ли тело сообщения <a NAME="t284005"></a>NVT ASCII

символы (по умолчанию) или 8-битные данные. Если

клиент не получил ключевое слово 8BITMIME от сервера

в ответ на команду EHLO, клиенту запрещено посылать

любые другие символы кроме NVT ASCII. (Когда мы будем

говорить о MIME в этом разделе, то увидим, что для MIME

не требуется 8-битный SMTP транспорт.) </small></p>



<p><small>Этот сервер также объявил ключевое слово

XADR. Любое ключевое слово, которое начинается на X,

обозначает местное расширение SMTP. </small></p>



<p><small>Следующий сервер также поддерживает ESMTP,

объявляя ключевые слова HELP и SIZE, которые мы уже

видели. Он также поддерживает три локальных

расширения, которые начинаются на X.</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="1">



<p></font><font FACE="Courier New" size="2">sun % <b>telnet dbc.mtview.ca.us 25<br>

</b>220 dbc.mtview.ca.us Sendmail 5.65/3.1.090690, it's Mon, 2 Aug 93 15:48:50 -0700<br>

<br>

<b>ehlo sun.tuc.noao.edu<br>

</b>250-Hello sun.tuc.noao.edu, pleased to meet you<br>

250-HELP<br>

250-SIZE<br>

250-XONE<br>

250-XVRB<br>

250 XQUE</font><font FACE="Arial">&nbsp;</p>



<p>&nbsp;</p>



<p><small>И в конце мы посмотрим, что произойдет,

когда клиент пытается использовать ESMTP, выдав

команду EHLO на сервер, который это не

поддерживает.</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="1">



<p></font><font FACE="Courier New" size="2">sun % <b>telnet relay1.uu.net 25<br>

</b>220 relay1.UU.NET Sendmail 5.61/UUNET-internet-primary ready at Mon, 2 Aug 93 18:50:27

-0400<br>

<br>

<b>ehlo sun.tuc.noao.edu<br>

</b>500 Command unrecognized<br>

<br>

<b>rset<br>

</b>250 Reset state</font><font FACE="Arial">&nbsp;</p>




<p>&nbsp;</p>



<p><small>Вместо того чтобы получить отклик 250 на

команду EHLO, клиент получил отклик 500. Затем клиент

должен исполнить команду RSET, а уже затем команду

HELO.</small></p>

<font size="3"><i><b>



<p><a NAME="t284006"></a>Изменения в заголовках:

использование не-ASCII символов</p>

</b></i></font>



<p><small>RFC 1522 [<a NAME="t284007"></a>Moore 1993] указывает способы

передачи не-ASCII символов в заголовках сообщений,

основанных на RFC 822. Основное назначение -

разрешить использовать дополнительные символы в

именах отправителя и получателя, а также в теме

сообщения. </small></p>



<p><small>Поле заголовка может содержать

закодированные слова. При этом формат следующий:</small></p>



<p>&nbsp;</p>



<p><small>=? charset ? encoding ? encoded text ?=</small></p>



<p>&nbsp;</p>



<p><small>charset это спецификация набора символов.

Приемлемые значения это две строки us-ascii и iso-8859-X,

где X это одна цифра, как, например, iso-8859-1. </small></p>



<p><small>encoding это один символ, который указывает

метод кодирования. Поддерживаются два значения.</small></p>



<p><small>&nbsp;</small> 



<ol>

  <li><small>Q означает <a NAME="t284008"></a>quoted-printable и

    предназначен для латинского набора символов.

    Большинство символов передаются как NVT ASCII

    (старший бит установлен в 0, естественно). <a NAME="t284009"></a>Любой отправляемый символ, у которого

    восьмой бит не равен 0, посылается как три

    символа: первый символ =, после чего следуют две

    шестнадцатиричные цифры. Например, символ й

    (бинарное 8-битное значение которого равно 0xe9)

    передается как три символа =E9. Пробелы всегда

    отправляются либо как подчеркивание, либо как

    три символа =20. Такое кодирование используется

    для текста, который в основном состоит из <a NAME="t284010"></a>ASCII с небольшим количеством

    специальных символов.</small></li>

  <li><small><a NAME="t284011"></a>B означает кодирование по

    основанию 64. Три последовательных байта текста (24

    бита) кодируются как четыре 6-битных значения. Для

    того, чтобы представить каждое из возможных

    6-битных значений, используется, 64 символа NVT ASCII,

    как показано на рисунке 28.6.<a NAME="t284012"></a></small></li>

</ol>



<p>&nbsp;</p>

</font>



<table BORDER="1" CELLSPACING="1" BORDERCOLOR="#000000" CELLPADDING="9" WIDTH="798">

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="3"><small><font FACE="Arial">6-битное

    значение </font></small></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="3"><font FACE="Arial"><small>ASCII символ </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="3"><font FACE="Arial"><small>6-битное

    значение </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="3"><font FACE="Arial"><small>ASCII символ </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="3"><font FACE="Arial"><small>6-битное

    значение </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="3"><font FACE="Arial"><small>ASCII символ </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="3"><font FACE="Arial"><small>6-битное

    значение </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="3"><font FACE="Arial"><small>ASCII символ </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>0 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>A </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>10 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>Q </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>20 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>g </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>30 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>w </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>1 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>B </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>11 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>R </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>21 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>h </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>31 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>x </small></font></td>

  </tr>

  <tr>


    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>2 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>C </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>12 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>S </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>22 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>i </small></font></td>


    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>32 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>y </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>3 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>D </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>13 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>T </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>23 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>j </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>33 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>z </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>4 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>E </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>14 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>U </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>24 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>k </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>34 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>0 </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>5 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>F </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>15 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>V </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>25 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>l </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>35 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>1 </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>6 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>G </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>16 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>W </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>26 </small></font></td>


    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>m </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>36 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>2 </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>7 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>H </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>17 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>X </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>27 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>n </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>37 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>3 </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>8 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>I </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>18 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>Y </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>28 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>o </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>38 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>4 </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>9 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>J </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>19 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>Z </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>29 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>p </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>39 </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>5 </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>a </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>K </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>1a </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>a </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>2a </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>q </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>3a </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>6 </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>b </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>L </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>1b </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>b </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>2b </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>r </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>3b </small></font></td>


    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>7 </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>c </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>M </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>1c </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>c </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>2c </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>s </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>3c </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>8 </small></font></td>

  </tr>


  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>d </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>N </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>1d </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>d </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>2d </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>t </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>3d </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>9 </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>E </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>O </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>1e </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>e </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>2e </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>u </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>3e </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>+ </small></font></td>

  </tr>

  <tr>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>f </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>P </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>1f </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>f </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>2f </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>v </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>3f </small></font></td>

    <td WIDTH="13%" VALIGN="TOP" HEIGHT="2"><font FACE="Arial"><small>/ </small></font></td>

  </tr>

</table>

<font FACE="Arial">



<p><small>Рисунок 28.6 Кодирование 6-битных значений

(кодирование на основе 64).</small></p>



<p>&nbsp;</p>



<p><small>Когда количество символов, которые

необходимо кодировать, не кратно трем, в качестве

символов заполнения используются знаки равно.</small></p>



<p>&nbsp;</p>



<p><small>Следующий пример этих двух типов

кодирования взят из RFC 1522:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="1">



<p></font><font FACE="Courier New" size="2">From: =?US-ASCII?Q?Keith_Moore?=

&lt;moore@cs.utk.edu&gt;<br>

To: =?ISO-8859-1?Q?Keld_J=F8rn_Simonsen?= &lt;keld@dkuug.dk&gt;<br>


CC: =?ISO-8859-1?Q?Andr=E9_?= Pirard &lt;PIRARD@vm1.ulg.ac.be&gt;<br>

Subject: =?ISO-8859-1?B?SWYgeW91IGNhbiByZWFkIHRoaXMgeW8=?=<br>

=?ISO-8859-2?B?dSB1bmRlcnN0YW5kIHRoZSBleGFtcGxlLg==?=</font><font FACE="Arial">&nbsp;</p>



<p>&nbsp;</p>



<p><small>Пользовательский агент имеет возможность

обработать эти заголовки, в результате чего

получится следующий вывод:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="1">



<p></font><font FACE="Courier New" size="2">From: Keith Moore &lt;moore@cs.utk.edu&gt;<br>

To: Keld Jorn Simonsen &lt;keld@dkuug.dk&gt;<br>

CC: Andre Pirard &lt;PIRARD@vm1.ulg.ac.be&gt;<br>

Subject: If you can read this you understand the example.</font><font FACE="Arial">&nbsp;</p>



<p>&nbsp;</p>



<p><small>Для того чтобы посмотреть, как работает

кодирование на основе 64, посмотрите на первые 4

закодированных символа в строке темы: SWYg. Напишем

6-битные значения для этих 4 символов в

соответствии с рисунком 28.6 (S=0x12, W=0x16, Y=0x18 и g=0x20) в

двоичном виде:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="1">



<p></font><font FACE="Courier New" size="2">010010 010110 011000 100000</p>

</font><font FACE="Arial">



<p>&nbsp;</p>



<p><small>Затем перегруппируем эти 24 бита в три

8-битных байта:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

01001001 01100110 00100000<br>

=0x49&nbsp;&nbsp;&nbsp; =0x66&nbsp;&nbsp;&nbsp; =0x20<br>

</p>

</font><font FACE="Arial">



<p>&nbsp;</p>



<p><small>которые в виде ASCII представляют собой I, f и

пробел.</small></p>

<font size="3"><i><b>



<p>Изменения в теле сообщения:

Многофункциональные расширения почты Internet (MIME -

Multipurpose Internet Mail Extensions) </p>

</b></i></font>



<p><small>Мы говорили, что RFC 822 описывает тело

сообщения как строки NVT ASCII текста, без структуры.

RFC 1521 <a NAME="t284013"></a>[Borenstein and Freed 1993] определяет

расширения, которые позволяют вводить структуру

в тело сообщения. Это называется

многофункциональным расширением почты Internet (<a NAME="t284014"></a>MIME - Multipurpose Internet Mail Extensions). </small></p>



<p><small><a NAME="t284015"></a>MIME не требует тех расширений,

что мы описали ранее в этом разделе (расширенный

SMTP или не-ASCII заголовки). MIME просто добавляет

некоторые новые заголовки (в соответствии с RFC 822),

которые сообщают получателю о структуре тела

сообщения. Тело сообщения может передаваться с

использованием NVT ASCII, вне зависимости от

содержимого почты. Несмотря на это некоторые из

расширений, которые мы только что описали, могут

быть вполне уместны при использовании вместе с

MIME - команда SIZE расширенного SMTP, так как MIME

сообщения могут быть довольно большими, и не-ASCII

заголовки, эти расширения не требуются для MIME.

Все что требуется для обмена MIME сообщениями с

другой стороной - необходимо, чтобы на обоих

концах присутствовали пользовательские агенты,

которые понимают MIME. На промежуточных MTA не

требуется никаких изменений. </small></p>



<p><small>MIME определяет пять новых полей заголовков:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="1">



<p></font><font FACE="Courier New" size="2">Mime-Version:<br>

Content-Type:<br>

Content-Transfer-Encoding:<br>

Content-ID:<br>

Content-Description:</font><font FACE="Arial">&nbsp;</p>



<p>&nbsp;</p>



<p><small>В качестве примера, приведены две строки

заголовка, которые могут присутствовать в

почтовом сообщении Internet:</small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="1">



<p></font><font FACE="Courier New" size="2">Mime-Version: 1.0<br>

Content-Type: TEXT/PLAIN; charset=US-ASCII</font><font FACE="Arial">&nbsp;</p>



<p>&nbsp;</p>



<p><small>Текущая версия MIME - 1.0, в которой сообщения

выглядят как простой <a NAME="t284016"></a>ASCII текст, что

является форматом по умолчанию для почты Internet.

Слово PLAIN определяет подтип типа содержимого (TEXT),

а строка charset=US-ASCII это параметр. </small></p>



<p><small>Text это всего лишь один из семи определенных

в MIME типов содержимого. На рисунке 28.7 приводится

краткое описание 16 различных типов содержимого и

подтипов, определенных в RFC 1521. Для конкретных

типов содержимого и подтипов может быть

определено большое количество параметров. </small></p>



<p><small>Тип содержимого и кодирование при передаче,

применяемое к телу сообщения, независимы друг от

друга. Здесь указаны поле заголовка Content-Type (тип

содержимого) и поле заголовка Content-Transfer-Encoding

(кодирование содержимого при передаче). В RFC 1521

определено пять различных форматов кодирования.</small>



<ol>

  <li><small>7bit, что является NVT ASCII, по умолчанию.</small></li>

  <li><small><a NAME="t284017"></a>quoted-printable, как мы видели в

    примере, приведенном ранее, используется с не-ASCII

    заголовками. Подобный тип кодирования применим,

    только когда небольшое количество символов

    имеет установленный восьмой бит. </small></li>

  <li><small><a NAME="t284018"></a>base64, показан на рисунке&nbsp;28.6. </small></li>

  <li><small><a NAME="t284019"></a>8bit содержит строки символов,

    некоторые из которых не-ASCII и имеют установленный

    восьмой бит. </small></li>

  <li><small><a NAME="t284020"></a>binary кодирование, используется в

    случае 8-битных данных, которые не содержат строк.<a NAME="t284021"></a></small></li>

</ol>



<p>&nbsp;</p>

</font>



<table BORDER="1" CELLSPACING="1" BORDERCOLOR="#000000" CELLPADDING="5" WIDTH="692">

  <tr>

    <td WIDTH="22%" VALIGN="TOP" BGCOLOR="#ffffff"><p ALIGN="CENTER"><small><font FACE="Arial">Тип

    содержимого</font></small></td>

    <td WIDTH="26%" VALIGN="TOP" BGCOLOR="#ffffff"><font FACE="Arial"><p ALIGN="CENTER"><small>Подтип</small></font></td>

    <td WIDTH="52%" VALIGN="TOP" BGCOLOR="#ffffff"><font FACE="Arial"><p ALIGN="CENTER"><small>Описание</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP"><font FACE="Arial"><small>text</small></font></td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>plain</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Неформатированный

    текст.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP">&nbsp;</td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>richtext</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Текст с простым

    форматированием, как, например, выделение жирным

    шрифтом, курсивом, подчеркивание и так далее.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP">&nbsp;</td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>enriched</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Прояснение,

    упрощение и усовершенствование richtext.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP"><font FACE="Arial"><small>multipart</small></font></td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>mixed</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Несколько частей


    тела сообщения обрабатываются последовательно.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP">&nbsp;</td>


    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>parallel</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Несколько частей

    тела сообщения могут быть обработаны

    параллельно.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP">&nbsp;</td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>digest</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Краткое изложение

    почты.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP">&nbsp;</td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>alternative</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Присутствует

    несколько частей тела сообщения, все с

    идентичным семантическим содержанием.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP"><font FACE="Arial"><small>message</small></font></td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>rfc822</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Содержимое это еще

    одно почтовое сообщение RFC 822.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP">&nbsp;</td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>partial</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Содержимое это

    фрагмент почтового сообщения.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP">&nbsp;</td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>external-body</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Содержимое это

    указатель на реальное сообщение.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP"><font FACE="Arial"><small>application</small></font></td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>octet-stream</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Произвольные

    двоичные данные.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP">&nbsp;</td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>postscript</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Программа PostScript.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP"><font FACE="Arial"><small>image</small></font></td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>jpeg</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Формат <a NAME="t284022"></a>ISO

    10918.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP">&nbsp;</td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>gif</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Формат CompuServe's Graphic

    Interchange.</small></font></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP"><font FACE="Arial"><small>audio</small></font></td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>basic</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><small><font FACE="Arial">Кодирование с

    использованием 8-битного ISDN формата </font><font FACE="Symbol">m</font><font FACE="Arial"> -law.</font></small></td>

  </tr>

  <tr>

    <td WIDTH="22%" VALIGN="TOP"><font FACE="Arial"><small>video</small></font></td>

    <td WIDTH="26%" VALIGN="TOP"><font FACE="Arial"><small>mpeg</small></font></td>

    <td WIDTH="52%" VALIGN="TOP"><font FACE="Arial"><small>Формат ISO 11172.</small></font></td>

  </tr>

</table>

<font FACE="Arial">



<p><small>Рисунок 28.7 Типы и подтипы содержимого MIME.</small></p>



<p>&nbsp;</p>



<p><small>Только первые три из приведенных приемлимы

для MTA работающих по правилам RFC 821, так как в этих

трех случаях генерируется содержимое тела

сообщения в виде только NVT <a NAME="t284023"></a>ASCII

символов. При использовании расширенного SMTP с

8BITMIME, поддерживается 8bit кодирование. </small></p>



<p><small>Так как тип содержимого и кодирование

независимы, RFC 1521 рекомендует quoted-printable для text с

не-ASCII данными, и base64 для данных типа image, audio, video и

octet-stream приложений. При этом гарантируется

максимальная совместимость с MTA, работающими по

правилам RFC 821. Типы содержимого multipart и message

должны быть кодированы как 7bit. </small></p>



<p><small>На рисунке 28.8 показано почтовое сообщение,

содержащее список распространяемых RFC, тип

содержимого - multipart. Подтип - mixed, это означает, что

каждая часть должна быть обработана

последовательно, разделители между частями

выглядят как строка NextPart, перед которой стоят два

дефиса в начала строки. </small></p>



<p><small>За каждым разделителем может следовать

строка, содержащая поля заголовка для следующей

части. Часть сообщения перед первым разделителем

игнорируется, так же как и часть следующая за

последним разделителем. </small></p>



<p><small>Так как за первым разделителем следуют

пустые строки и не указаны поля заголовка, между

первым и вторым разделителями подразумевается

тип содержимого данных text/plain с набором символов

us-ascii. Это текстовое описание нового RFC. </small></p>



<p><small>За вторым разделителем, однако, следуют

поля заголовков. Они определяют следующее

сообщение как multipart, с разделителем OtherAccess. Подтип

- alternative, причем присутствует два альтернативных

варианта. Первый OtherAccess предназначен для

получения RFC с использованием электронной почты,

а второй для получения с использованием

анонимного FTP. Пользовательский агент MIME

предоставляет список из двух возможных

вариантов, что позволяет автоматически получить

копию RFC с использованием либо почты, либо

анонимного FTP.&nbsp;<a NAME="t284024"></a></small></p>



<p>&nbsp;</p>

</font><font FACE="Courier New" size="2">



<p><br>

To: rfc-dist@nic.ddn.mil<br>

Subject: RFC1479 on IDPR Protocol<br>

Mime-Version: 1.0<br>

Content-Type: Multipart/Mixed; Boundary=&quot;NextPart&quot;<br>

Date: Fri, 23 Jul 93 12:17:43 PDT<br>

From: &quot;Joyce K. Reynolds&quot; &lt;jkrey@isi.edu&gt;<br>

<br>

<br>

--NextPart

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; первый

разделитель<br>

<br>

A new Request for Comments is now available in online RFC libraries.<br>

<br>

. . .

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (здесь

приводится описание нового RFC)<br>

<br>

Below is the data which will enable a MIME compliant Mail Reader<br>

implementation to automatically retrieve the ASCII version<br>

of the RFCs.<br>

<br>

--NextPart

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; второй

разделитель<br>

Content-Type: Multipart/Alternative; Boundary=&quot;OtherAccess&quot;<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; сообщение,

состоящее из нескольких <br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; частей

с новым разделителем<br>

--OtherAccess<br>

Content-Type: Message/External-body;<br>

access-type=&quot;mail-server&quot;;<br>

server=&quot;mail-server@nisc.sri.com&quot;<br>

<br>

Content-Type: text/plain<br>

<br>

SEND rfc1479.txt<br>

<br>

--OtherAccess<br>

Content-Type: Message/External-body;<br>

name=&quot;rfc1479.txt&quot;;<br>

site=&quot;ds.internic.net&quot;;<br>

access-type=&quot;anon-ftp&quot;;<br>

directory=&quot;rfc&quot;<br>

<br>

Content-Type: text/plain<br>

<br>

--OtherAccess--<br>

--NextPart--

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; последний

разделитель<br>

</p>

</font><font FACE="Arial">



<p>&nbsp;</p>



<p><small>Рисунок 28.8 Пример MIME сообщения, состоящего

из нескольких частей.</small></p>



<p>&nbsp;</p>



<p><small>Этот раздел является кратким описанием MIME.

Для получения более подробной информации и

примеров MIME можно обратиться к RFC 1521 и [<a NAME="t284025"></a>Rose

1993].</small></p>

<font size="3"><u><b>



<p><a NAME="t285000"></a>Краткие выводы</p>

</b></u></font>



<p><small>В работе электронной почты принимают

участие пользовательские агенты на обоих концах

(отправитель и получатель), а также два или

несколько агентов передачи сообщения. Мы можем

поделить почтовое сообщение на три части:

конверт, заголовки и тело сообщения. Мы видели,

как происходит обмен этими частями с

использованием SMTP, который является стандартом в

Internet. Все три состоят из символов NVT <a NAME="t285001"></a>ASCII.

</small></p>



<p><small>Также мы рассмотрели новые расширения этих

трех частей: расширенный SMTP для конверта, не-ASCII

заголовки и дополнительная структура для тела

сообщения с использованием MIME. Структура и

кодирование, используемые MIME, позволяют

обмениваться двоичными данными с использованием

существующих 7-битных MTA SMTP.</small></p>

<font size="3"><i><b>



<p>Упражнения</b></i></font><font size="1"> 



<ol>

  <li></font><font size="2">Прочитайте RFC 822, чтобы найти

    объяснение того, что называется <a NAME="t285002"></a>domain

    literal. Попробуйте послать почту самому себе.</li>

  <li>За исключением установления и прекращения

    соединения, какое минимальное количество

    промежутков времени равных времени возврата,

    необходимо, чтобы послать небольшое почтовое

    сообщение?</li>

  <li>TCP это <a NAME="t285003"></a>полнодуплексный протокол,

    тогда как SMTP, использующий TCP, использует его в

    полудуплексном режиме. Клиент посылает команду,

    а затем останавливается и ждет отклика. Почему

    клиент не может послать несколько команд за раз,

    например, с помощью одной записи, содержащей

    команды HELO, MAIL, RCPT, DATA и QUIT (представим, что тело

    сообщения не очень велико)?</li>

  <li>Как это полудуплексное функционирование SMTP

    может поставить в тупик механизм медленного

    старта, когда сеть работает близко к пределу

    своих возможностей?</li>

  <li>Если существует несколько <a NAME="t285004"></a>MX записей

    с одним и тем же значением предпочтительности,

    должны ли они всегда возвращаться сервером имен

    в одном и том же порядке?</font><font size="1"></li>

</ol>

</font></font>



<p><small><a HREF="index.html"><img SRC="contents.jpg" BORDER="0" WIDTH="94" HEIGHT="20"></a><a HREF="../home.htm"><img SRC="begin.jpg" BORDER="0" WIDTH="68" HEIGHT="20"></a><a HREF="glava29.html"><img SRC="forward.jpg" BORDER="0" WIDTH="68" HEIGHT="20"></a><a HREF="glava27.html"><img SRC="back_b.jpg" BORDER="0" WIDTH="68" HEIGHT="20"></a><img SRC="index.jpg" WIDTH="68" HEIGHT="20"></small></p>


<font size="1">



<p>&nbsp;</p>

</font>
</div>
</body>

</html>

