терминология: параметр - формальный, аргумент - фактический

удаляет комментарии и \\\n
строки и символы считает как один токен

=== поиск и замена макросов ===
переменные:список использованных макросов
ищет идентификатор, определенный ранее в дефайне и не находящийся в списке использованных макросов
после того, как нашел
если это макрос с параметрами
	выделение(группировка) аргументов макроса
		после идентификатора ищет через пробелы открывющуюся круглую скобку
			если не нашел до того как кончатся пробелы 
			 - считается, что этот идентификатор не является макросом
		далее идет список токенов, разделенных (не вложенными в круглые скобки) запятыми
		далее закрывающая круглая скобка
			если не соответствует число аргументов числу параметров
			 - только warning (по крайней мере в MSVC)
				, а нехватающие аргументы заполняются пустыми последовательностями токенов
					!!!!! проверить
				, а лишние аргументы отбрасываются
	отбрасываются символы пустого пространства, окружающие аргументы по краям
	с каждым аргументом
		если (в замещающей последовательности) перед параметром(соответстующем аргументу) не стоит # и ни перед ни после параметра не стоит ##
			то идет поиск и замена макросов в этом аргументе //рекурсивный вызов
				(текущий список использованных макросов передается при этом вызове)
				(поиск и замена макросов в аргументе не влияет на текущий список использованных макросов)
			после чего полученный аргумент подставляется на место параметра
		если перед праметром стоит #
			то " и \ в аргументе экранируются (??? а перевод строки в аргументе ???)
			после чего #параметр заменяется на "аргумент"
		##
		??? если # или ## не связаны с аргументами ???
в список использованных макросов добавляется текущий //только после подстановки аргументов
поиск и замена макросов в получившемся результате //рекрсивный вызов
(текущий список использованных макросов передается при этом вызове)
=== конец раскрытия макроса ===


todo
придумать тесты